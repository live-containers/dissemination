\chapter{Evaluation} \label{chap:evaluation}

In the previous chapter, \S\ref{chap:system}, we have presented our implementation of live migration of containers using \criu and \runc, and have motivated our design choices with micro-benchmarks that fulfil the initial objectives specified in the introduction.

In this chapter, we move on to evaluate the system as a whole, and how the different features interlace and work together, and  how does our system compare to traditional virtual machine live migration.

\section{Macro-Benchmarks}

\subsection{Iterative, Remote, Diskless Migration}

Goal here would be to have the diagram we went over once, in which we plot over time the amount of memory we send.

\cs{Re-do the initial plot presented}

\subsection{Checkpointing TCP Connections inside Network Namespaces}

\cs{Include the content from Decentralized Systems}

\section{Comparison with Virtual Machines Migration}

\section{Scalability}

\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{figs/key-scalability/key_scalability.pdf}
    \caption[Scalability with respect to the memory to transfer.]{Scalability with respect to the memory to transfer. We compare our system with manual live migration when running in the same machine with a one-shot migration.\label{fig:key-scalability}}
\end{figure}

\cs{Downtime as we increase the number of iterations (i.e. threshold)}

\cs{Comparison with VM Teleport}

\begin{lstlisting}[style=Bash,caption={Script to teleport a VirtualBox VM, and run the macrobenchmark.},label={code:vm-teleport}]
#!/bin/bash

# Configure target machine to wait for a teleport request to arrive
VBoxManage modifyvm 'CRIU-Debian-Teleport-Target' --teleporter on --teleporterport 6000

# Iterate over the different number of keys
for num_keys in 1 10 100 1000 10000 100000 1000000 10000000
do
    # Start the host machine as usual
    ssh <HOST_VM>
    cd ~/runc-containers/redis && ./run_redis.sh 100000

    # Start the target machine, if using a normal start, a process dialog will appear

    # Run the migration
    time VBoxManage controlvm 'CRIU-Debian' teleport --host localhost --port 6000

    # Shut down both VMs
done
\end{lstlisting}

\cs{Compare with P-Haul if time}
